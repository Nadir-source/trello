{% extends "layout.html" %}
{% block content %}

<div class="page-head">
  <div class="page-title">
    <h2>RÃ©servations</h2>
    <div class="muted">CrÃ©er une demande + gÃ©nÃ©rer le contrat (FR + AR)</div>
  </div>

  <div class="page-actions">
    <span class="badge warning">ğŸ“¥ {{ stats.demandes }} Demandes</span>
    <span class="badge primary">ğŸ“… {{ stats.reserved }} RÃ©servÃ©es</span>
    <span class="badge success">ğŸ”‘ {{ stats.ongoing }} En cours</span>
    <span class="badge">âœ… {{ stats.done }} TerminÃ©es</span>
  </div>
</div>

<div class="card">
  <div class="card-header">
    <div>
      <h3>CrÃ©er une demande</h3>
      <div class="small">Les clients / vÃ©hicules viennent de Trello. Si tu ne vois rien, vÃ©rifie les listes Trello â€œClientsâ€ et â€œVÃ©hiculesâ€.</div>
    </div>
    <span class="badge primary">DZD â€¢ CNI/Passeport</span>
  </div>

  <form method="post" action="/bookings/create" class="form">

    <div class="form-grid">
      <div class="field" style="grid-column: 1 / -1;">
        <label>Titre</label>
        <input class="input" name="title" placeholder="Ex: Location Clio 10-12" />
      </div>

      <div class="field">
        <label>Client</label>
        <select name="client_id">
          <option value="">-- choisir --</option>
          {% for c in clients %}
            <option value="{{c.id}}">{{c.name}}</option>
          {% endfor %}
        </select>
        <div class="small">Si vide : crÃ©e une carte dans la liste Trello â€œClientsâ€.</div>
      </div>

      <div class="field">
        <label>VÃ©hicule</label>
        <select name="vehicle_id">
          <option value="">-- choisir --</option>
          {% for v in vehicles %}
            <option value="{{v.id}}">{{v.name}}</option>
          {% endfor %}
        </select>
        <div class="small">Si vide : crÃ©e une carte dans la liste Trello â€œVÃ©hiculesâ€.</div>
      </div>

      <div class="field">
        <label>DÃ©but</label>
        <input class="input" name="start" placeholder="YYYY-MM-DD" />
      </div>

      <div class="field">
        <label>Fin</label>
        <input class="input" name="end" placeholder="YYYY-MM-DD" />
      </div>

      <div class="field">
        <label>Prix / jour (DZD)</label>
        <input class="input" name="ppd" placeholder="Ex: 8500" />
      </div>

      <div class="field">
        <label>DÃ©pÃ´t (DZD)</label>
        <input class="input" name="deposit" placeholder="Ex: 20000" />
      </div>

      <div class="field">
        <label>DÃ©jÃ  payÃ© (DZD)</label>
        <input class="input" name="paid" placeholder="Ex: 17000" />
      </div>

      <div class="field">
        <label>MÃ©thode</label>
        <select name="method">
          <option value="Cash">Cash</option>
          <option value="Virement">Virement</option>
          <option value="Carte">Carte</option>
        </select>
      </div>

      <div class="field">
        <label>Document</label>
        <select name="doc">
          <option value="">--</option>
          <option value="CNI">Carte Nationale</option>
          <option value="PASSPORT">Passeport</option>
        </select>
      </div>

      <div class="field">
        <label>Lieu remise</label>
        <input class="input" name="pickup" placeholder="Ex: AÃ©roport" />
      </div>

      <div class="field">
        <label>Lieu retour</label>
        <input class="input" name="return_place" placeholder="Ex: Centre ville" />
      </div>

      <div class="field" style="grid-column: 1 / -1;">
        <label>Options</label>
        <div class="check-row">
          <label class="check"><input type="checkbox" name="extra_driver"> Chauffeur</label>
          <label class="check"><input type="checkbox" name="extra_gps"> GPS</label>
          <label class="check"><input type="checkbox" name="extra_baby"> SiÃ¨ge bÃ©bÃ©</label>
        </div>
      </div>

      <div class="field" style="grid-column: 1 / -1;">
        <label>Notes</label>
        <textarea name="notes" placeholder="Remarques..."></textarea>
      </div>
    </div>

    <div style="display:flex; gap:10px; flex-wrap:wrap; justify-content:flex-end">
      <button class="btn primary" type="submit">CrÃ©er demande</button>
    </div>
  </form>
</div>

<div class="hr"></div>

<div class="grid cols-3">
  <!-- DEMANDES -->
  <section class="card">
    <div class="card-header">
      <div>
        <h3>ğŸ“¥ Demandes</h3>
        <div class="small">{{ demandes|length }} Ã©lÃ©ment(s)</div>
      </div>
      <span class="badge warning">Ã€ confirmer</span>
    </div>

    <div class="list">
      {% for c in demandes %}
      <div class="item">
        <div class="row">
          <div>
            <div class="title">{{ c.name }}</div>
            <div class="meta">
              ğŸ‘¤ {{ c.client }} â€¢ ğŸš— {{ c.vehicle }}<br/>
              ğŸ“… {{ c.start }} â†’ {{ c.end }}
            </div>
          </div>
          <div class="actions">
            <form method="post" action="/bookings/move/{{c.id}}/reserved">
              <button class="btn" type="submit">â¡ï¸ Confirmer</button>
            </form>
            <form method="post" action="/bookings/move/{{c.id}}/cancel">
              <button class="btn danger" type="submit">Annuler</button>
            </form>
          </div>
        </div>
      </div>
      {% endfor %}
    </div>
  </section>

  <!-- RESERVEES -->
  <section class="card">
    <div class="card-header">
      <div>
        <h3>ğŸ“… RÃ©servÃ©es</h3>
        <div class="small">{{ reserved|length }} Ã©lÃ©ment(s)</div>
      </div>
      <span class="badge primary">Contrat dispo</span>
    </div>

    <div class="list">
      {% for c in reserved %}
      <div class="item">
        <div class="row">
          <div>
            <div class="title">{{ c.name }}</div>
            <div class="meta">
              ğŸ‘¤ {{ c.client }} â€¢ ğŸš— {{ c.vehicle }}<br/>
              ğŸ“… {{ c.start }} â†’ {{ c.end }}
            </div>
          </div>
          <div class="actions">
            <a class="btn" href="/bookings/contract.pdf/{{c.id}}">ğŸ“„ Contrat FR+AR</a>
            <form method="post" action="/bookings/move/{{c.id}}/ongoing">
              <button class="btn success" type="submit">ğŸ”‘ En cours</button>
            </form>
          </div>
        </div>
      </div>
      {% endfor %}
    </div>
  </section>

  <!-- EN COURS -->
  <section class="card">
    <div class="card-header">
      <div>
        <h3>ğŸ”‘ En cours</h3>
        <div class="small">{{ ongoing|length }} Ã©lÃ©ment(s)</div>
      </div>
      <span class="badge success">Actif</span>
    </div>

    <div class="list">
      {% for c in ongoing %}
      <div class="item">
        <div class="row">
          <div>
            <div class="title">{{ c.name }}</div>
            <div class="meta">
              ğŸ‘¤ {{ c.client }} â€¢ ğŸš— {{ c.vehicle }}<br/>
              ğŸ“… {{ c.start }} â†’ {{ c.end }}
            </div>
          </div>
          <div class="actions">
            <a class="btn" href="/bookings/contract.pdf/{{c.id}}">ğŸ“„ Contrat</a>
            <form method="post" action="/bookings/move/{{c.id}}/done">
              <button class="btn" type="submit">âœ… Terminer</button>
            </form>
          </div>
        </div>
      </div>
      {% endfor %}
    </div>
  </section>
</div>

{% endblock %}

