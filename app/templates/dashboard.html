{% extends "layout.html" %}
{% block content %}

<div class="page-head">
  <div>
    <h1>Dashboard</h1>
    <div class="muted">KPIs â€¢ aperÃ§u business â€¢ actions rapides</div>
    <div class="muted" style="margin-top:6px;">
      ConnectÃ©: <b>{{name}}</b> ({{role}})
      {% if board %}
        â€” Board: <a href="{{board.url}}" target="_blank">{{board.name}}</a>
      {% endif %}
    </div>
  </div>

  <div class="row">
    <a class="btn" href="/bookings">â• Nouvelle rÃ©servation</a>
    <a class="btn" href="/clients">ğŸ‘¤ Clients</a>
    <a class="btn" href="/vehicles">ğŸš— VÃ©hicules</a>
    <a class="btn" href="/finance">ğŸ’° Finance</a>
  </div>
</div>

<div class="kpi-grid">
  <div class="kpi kpi-blue"><div class="kpi-title">Demandes</div><div class="kpi-value">{{stats.demandes}}</div></div>
  <div class="kpi kpi-violet"><div class="kpi-title">RÃ©servÃ©es</div><div class="kpi-value">{{stats.reserved}}</div></div>
  <div class="kpi kpi-cyan"><div class="kpi-title">En cours</div><div class="kpi-value">{{stats.ongoing}}</div></div>
  <div class="kpi kpi-green"><div class="kpi-title">TerminÃ©es</div><div class="kpi-value">{{stats.done}}</div></div>

  <div class="kpi kpi-orange"><div class="kpi-title">Clients</div><div class="kpi-value">{{stats.clients}}</div></div>
  <div class="kpi kpi-pink"><div class="kpi-title">VÃ©hicules</div><div class="kpi-value">{{stats.vehicles}}</div></div>

  <div class="kpi"><div class="kpi-title">Factures ouvertes</div><div class="kpi-value">{{stats.invoices_open}}</div></div>
  <div class="kpi"><div class="kpi-title">Factures payÃ©es</div><div class="kpi-value">{{stats.invoices_paid}}</div></div>

  <div class="kpi kpi-green"><div class="kpi-title">ğŸ’° Revenu encaissÃ©</div><div class="kpi-value">{{stats.revenue_paid}} â‚¬</div></div>
  <div class="kpi kpi-yellow"><div class="kpi-title">ğŸ§¾ En attente de paiement</div><div class="kpi-value">{{stats.revenue_open}} â‚¬</div></div>
  <div class="kpi kpi-orange"><div class="kpi-title">ğŸ’¸ DÃ©penses</div><div class="kpi-value">{{stats.expenses}} â‚¬</div></div>
  <div class="kpi kpi-violet"><div class="kpi-title">ğŸ“ˆ BÃ©nÃ©fice estimÃ©</div><div class="kpi-value">{{stats.estimated_profit}} â‚¬</div></div>
</div>

<div class="columns" style="margin-top:16px;">
  <section class="col">
    <div class="col-head"><h3>ğŸ“¥ DerniÃ¨res demandes</h3><span class="pill">{{stats.demandes}}</span></div>
    {% if demandes %}
      {% for c in demandes %}
        <div class="card item">
          <div class="title">{{c.name}}</div>
          <div class="muted small">ID: {{c.id}}</div>
          <div class="row" style="margin-top:10px;">
            <a class="btn" href="/bookings">Ouvrir</a>
          </div>
        </div>
      {% endfor %}
    {% else %}
      <div class="card item"><div class="muted">Aucune demande.</div></div>
    {% endif %}
  </section>

  <section class="col">
    <div class="col-head"><h3>ğŸ“… RÃ©servÃ©es</h3><span class="pill">{{stats.reserved}}</span></div>
    {% if reserved_cards %}
      {% for c in reserved_cards %}
        <div class="card item">
          <div class="title">{{c.name}}</div>
          <div class="muted small">ID: {{c.id}}</div>
          <div class="row" style="margin-top:10px;">
            <a class="btn primary" href="/bookings">Voir</a>
          </div>
        </div>
      {% endfor %}
    {% else %}
      <div class="card item"><div class="muted">Aucune rÃ©servation.</div></div>
    {% endif %}
  </section>

  <section class="col">
    <div class="col-head"><h3>ğŸ”‘ En cours</h3><span class="pill">{{stats.ongoing}}</span></div>
    {% if ongoing_cards %}
      {% for c in ongoing_cards %}
        <div class="card item">
          <div class="title">{{c.name}}</div>
          <div class="muted small">ID: {{c.id}}</div>
        </div>
      {% endfor %}
    {% else %}
      <div class="card item"><div class="muted">Aucune location en cours.</div></div>
    {% endif %}
  </section>
</div>

<!-- Graphiques -->
<div class="columns" style="margin-top:32px;">
  <section class="col">
    <div class="col-head"><h3>ğŸ“Š RÃ©partition des rÃ©servations</h3></div>
    <canvas id="bookingsChart"></canvas>
  </section>

  <section class="col">
    <div class="col-head"><h3>ğŸ’° Finances</h3></div>
    <canvas id="financeChart"></canvas>
  </section>
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
  const bookingsData = {
    labels: ['Demandes', 'RÃ©servÃ©es', 'En cours', 'TerminÃ©es', 'AnnulÃ©es'],
    datasets: [{
      label: 'RÃ©servations',
      data: [
        {{ stats.demandes }},
        {{ stats.reserved }},
        {{ stats.ongoing }},
        {{ stats.done }},
        {{ stats.canceled }}
      ],
      backgroundColor: ['#36A2EB', '#9B59B6', '#2ECC71', '#1ABC9C', '#E74C3C']
    }]
  };

  new Chart(document.getElementById('bookingsChart'), {
    type: 'pie',
    data: bookingsData
  });

  const financeData = {
    labels: ['Revenu', 'DÃ©penses', 'Profit'],
    datasets: [{
      label: 'Montant (â‚¬)',
      data: [
        {{ stats.revenue_paid }},
        {{ stats.expenses }},
        {{ stats.estimated_profit }}
      ],
      backgroundColor: ['#2ECC71', '#E67E22', '#3498DB']
    }]
  };

  new Chart(document.getElementById('financeChart'), {
    type: 'bar',
    data: financeData,
    options: {
      scales: {
        y: {
          beginAtZero: true
        }
      }
    }
  });
</script>

{% endblock %}

