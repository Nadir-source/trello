{% extends "layout.html" %}
{% block content %}

<div class="page-head">
  <div>
    <h1>Dashboard</h1>
    <div class="muted">
      Vue globale : rÃ©servations, clients, vÃ©hicules, finance
    </div>
  </div>

  <div class="stats">
    <div class="stat"><div class="n">{{stats.demandes}}</div><div class="l">Demandes</div></div>
    <div class="stat"><div class="n">{{stats.reserved}}</div><div class="l">RÃ©servÃ©es</div></div>
    <div class="stat"><div class="n">{{stats.ongoing}}</div><div class="l">En cours</div></div>
    <div class="stat"><div class="n">{{stats.done}}</div><div class="l">TerminÃ©es</div></div>
  </div>
</div>

<div class="columns" style="grid-template-columns: 2fr 1fr 1fr;">
  <section class="card panel glow">
    <div class="card-title">âš¡ RÃ©sumÃ© rapide</div>
    <div class="muted">
      Board Trello :
      {% if board_url %}
        <a class="btn" style="margin-left:8px" href="{{board_url}}" target="_blank">Ouvrir Trello</a>
      {% endif %}
    </div>

    <div style="height:10px"></div>

    <div class="card" style="padding:14px; background: rgba(255,255,255,.03);">
      <div style="display:flex; justify-content:space-between; gap:10px; flex-wrap:wrap;">
        <div>
          <div style="font-weight:950">ğŸ“Œ Objectif du jour</div>
          <div class="muted small">Confirmer les demandes + gÃ©nÃ©rer contrats + encaisser paiements</div>
        </div>
        <div style="display:flex; gap:10px; flex-wrap:wrap;">
          <a class="btn primary" href="/bookings">â• Nouvelle rÃ©servation</a>
          <a class="btn" href="/finance">ğŸ’° Finance</a>
        </div>
      </div>
    </div>

    <div style="height:12px"></div>

    <div class="card" style="padding:14px; background: rgba(255,255,255,.03);">
      <div style="font-weight:950; margin-bottom:6px">ğŸ§  Conseils (workflow)</div>
      <ul class="muted" style="margin:0; padding-left:18px; line-height:1.7">
        <li>CrÃ©er demande â†’ passer en RÃ©servÃ©e</li>
        <li>GÃ©nÃ©rer Contrat FR/AR â†’ imprimer / signer</li>
        <li>Passer En cours (remise clÃ©) â†’ puis TerminÃ©e</li>
      </ul>
    </div>
  </section>

  <section class="card panel">
    <div class="card-title">ğŸ‘¥ Clients</div>
    <div style="font-size:34px; font-weight:950">{{stats.clients or 0}}</div>
    <div class="muted small">Cartes dans la liste Clients</div>
    <div style="height:10px"></div>
    <a class="btn" href="/clients">Ouvrir</a>
  </section>

  <section class="card panel">
    <div class="card-title">ğŸš— VÃ©hicules</div>
    <div style="font-size:34px; font-weight:950">{{stats.vehicles or 0}}</div>
    <div class="muted small">Cartes dans la liste VÃ©hicules</div>
    <div style="height:10px"></div>
    <a class="btn" href="/vehicles">Ouvrir</a>
  </section>
</div>

<div style="height:12px"></div>

<div class="columns" style="grid-template-columns: 1.2fr 1.8fr;">
  <section class="card panel glow">
    <div class="card-title">ğŸ’³ Finance</div>
    <div class="muted">Vue simple (tu peux enrichir aprÃ¨s)</div>
    <div style="height:10px"></div>

    <div class="card" style="padding:14px; background: rgba(255,255,255,.03);">
      <div style="display:flex; justify-content:space-between; gap:10px; flex-wrap:wrap;">
        <div>
          <div style="font-weight:950">Factures ouvertes</div>
          <div style="font-size:26px; font-weight:950">{{stats.invoices_open}}</div>
        </div>
        <div>
          <div style="font-weight:950">Factures payÃ©es</div>
          <div style="font-size:26px; font-weight:950">{{stats.invoices_paid}}</div>
        </div>
      </div>

      <div style="height:10px"></div>
      <a class="btn" href="/finance">Voir dÃ©tails</a>
    </div>
  </section>

  <section class="card panel">
    <div class="card-title">ğŸ§¾ DerniÃ¨res rÃ©servations</div>
    <div class="muted small">Vue â€œmini-kanbanâ€ pour voir rapidement</div>
    <div style="height:12px"></div>

    <div class="columns" style="grid-template-columns: 1fr 1fr 1fr; margin-top:0">
      <div class="col">
        <div class="col-head"><h3>ğŸ“¥ Demandes</h3><span class="pill">{{demandes|length}}</span></div>
        {% for c in demandes[:3] %}
          <div class="card item">
            <div class="title">{{c.name}}</div>
            <div class="muted small">ğŸ‘¤ {{c.client}} â€¢ ğŸš— {{c.vehicle}}</div>
          </div>
        {% endfor %}
      </div>

      <div class="col">
        <div class="col-head"><h3>ğŸ“… RÃ©servÃ©es</h3><span class="pill">{{reserved|length}}</span></div>
        {% for c in reserved[:3] %}
          <div class="card item">
            <div class="title">{{c.name}}</div>
            <div class="muted small">ğŸ“… {{c.start}} â†’ {{c.end}}</div>
            <a class="btn" style="margin-top:8px" href="/bookings/contract.pdf/{{c.id}}" target="_blank">ğŸ“„ Contrat</a>
          </div>
        {% endfor %}
      </div>

      <div class="col">
        <div class="col-head"><h3>ğŸ”‘ En cours</h3><span class="pill">{{ongoing|length}}</span></div>
        {% for c in ongoing[:3] %}
          <div class="card item">
            <div class="title">{{c.name}}</div>
            <div class="muted small">ğŸ‘¤ {{c.client}} â€¢ ğŸš— {{c.vehicle}}</div>
          </div>
        {% endfor %}
      </div>
    </div>

    <div style="height:10px"></div>
    <a class="btn primary" href="/bookings">Ouvrir RÃ©servations</a>
  </section>
</div>

{% endblock %}

