{% extends "layout.html" %}
{% block title %}R√©servations{% endblock %}

{% block content %}
<div class="page">
  <h1 style="margin:0 0 14px 0;">R√©servations</h1>

  <div class="stats-grid">
    <div class="stat neon-cyan"><div class="n">{{ stats.demandes }}</div><div class="l">Demandes</div></div>
    <div class="stat neon-green"><div class="n">{{ stats.reserved }}</div><div class="l">R√©serv√©es</div></div>
    <div class="stat neon-purple"><div class="n">{{ stats.ongoing }}</div><div class="l">En cours</div></div>
    <div class="stat neon-yellow"><div class="n">{{ stats.done }}</div><div class="l">Termin√©es</div></div>
    <div class="stat"><div class="n">{{ stats.clients }}</div><div class="l">Clients</div></div>
    <div class="stat"><div class="n">{{ stats.vehicles_available }}</div><div class="l">V√©hicules dispo</div></div>
  </div>

  <div class="card">
    <h2 style="margin:0 0 10px 0;">Cr√©er une r√©servation</h2>

    <!-- ‚úÖ IMPORTANT: method="POST" + action bookings.create -->
    <form method="POST" action="{{ url_for('bookings.create') }}" class="grid">
      <div class="field">
        <label>Client</label>
        <select name="client_id" required>
          <option value="">‚Äî Choisir un client ‚Äî</option>
          {% for c in clients %}
            <option value="{{ c.id }}">{{ c.label }}{% if c.phone %} ‚Ä¢ {{ c.phone }}{% endif %}</option>
          {% endfor %}
        </select>
      </div>

      <div class="field">
        <label>V√©hicule</label>
        <select name="vehicle_id" required>
          <option value="">‚Äî Choisir un v√©hicule ‚Äî</option>
          {% for v in vehicles %}
            {% if v.status == "AVAILABLE" %}
              <option value="{{ v.id }}">{{ v.label }}</option>
            {% endif %}
          {% endfor %}
        </select>
        <div class="hint">Seuls les v√©hicules avec status <b>AVAILABLE</b> sont propos√©s.</div>
      </div>

      <div class="field">
        <label>Date d√©but</label>
        <input type="datetime-local" name="start_date" required>
      </div>

      <div class="field">
        <label>Date fin</label>
        <input type="datetime-local" name="end_date" required>
      </div>

      <div class="field">
        <label>Lieu remise</label>
        <input type="text" name="pickup_location" required>
      </div>

      <div class="field">
        <label>Lieu retour</label>
        <input type="text" name="return_location" required>
      </div>

      <div class="field">
        <label>Type document</label>
        <select name="doc_type">
          <option value="CNI">CNI</option>
          <option value="Passeport">Passeport</option>
          <option value="Permis">Permis</option>
        </select>
      </div>

      <div class="field">
        <label>Options</label>
        <div class="checks">
          <label><input type="checkbox" name="opt_gps"> GPS</label>
          <label><input type="checkbox" name="opt_chauffeur"> Chauffeur</label>
          <label><input type="checkbox" name="opt_baby_seat"> Si√®ge b√©b√©</label>
        </div>
      </div>

      <div class="field full">
        <label>Notes</label>
        <textarea name="notes" rows="3"></textarea>
      </div>

      <div class="field full">
        <button class="btn" type="submit">‚úÖ Cr√©er</button>
      </div>
    </form>
  </div>

  <div class="columns">
    <div class="col">
      <h3>üì• Demandes</h3>
      {% for c in demandes %}<div class="item">{{ c.name }}</div>{% else %}<div class="muted">Aucune</div>{% endfor %}
    </div>

    <div class="col">
      <h3>‚úÖ R√©serv√©es</h3>
      {% for c in reserved %}<div class="item">{{ c.name }}</div>{% else %}<div class="muted">Aucune</div>{% endfor %}
    </div>

    <div class="col">
      <h3>üîë En cours</h3>
      {% for c in ongoing %}<div class="item">{{ c.name }}</div>{% else %}<div class="muted">Aucune</div>{% endfor %}
    </div>

    <div class="col">
      <h3>üèÅ Termin√©es</h3>
      {% for c in done %}<div class="item">{{ c.name }}</div>{% else %}<div class="muted">Aucune</div>{% endfor %}
    </div>
  </div>
</div>

<style>
  .stats-grid { display:grid; grid-template-columns: repeat(6, minmax(0,1fr)); gap:10px; margin-bottom:16px; }
  .stat { padding:12px; border-radius:14px; background:rgba(255,255,255,.03); border:1px solid rgba(255,255,255,.06); }
  .stat .n { font-size:22px; font-weight:800; }
  .stat .l { opacity:.75; margin-top:2px; font-size:12px; }
  .neon-cyan { outline:2px solid rgba(34,211,238,.18); }
  .neon-green { outline:2px solid rgba(34,197,94,.18); }
  .neon-purple { outline:2px solid rgba(168,85,247,.18); }
  .neon-yellow { outline:2px solid rgba(250,204,21,.18); }
  .card { padding:14px; border-radius:16px; background:rgba(255,255,255,.03); border:1px solid rgba(255,255,255,.06); margin-bottom:18px; }
  .grid { display:grid; grid-template-columns: repeat(2, minmax(0,1fr)); gap:12px; }
  .field { display:flex; flex-direction:column; gap:6px; }
  .field.full { grid-column: 1 / -1; }
  label { font-size:12px; opacity:.8; }
  input, select, textarea { padding:10px; border-radius:12px; border:1px solid rgba(255,255,255,.12); background:rgba(0,0,0,.2); color:#e9eefc; }
  .checks { display:flex; gap:12px; flex-wrap:wrap; padding:10px; border-radius:12px; border:1px solid rgba(255,255,255,.12); background:rgba(0,0,0,.15); }
  .btn { padding:10px 14px; border-radius:12px; border:1px solid rgba(255,255,255,.12); background:rgba(59,130,246,.18); color:#e9eefc; font-weight:800; cursor:pointer; }
  .btn:hover { background:rgba(59,130,246,.25); }
  .hint { font-size:12px; opacity:.65; }
  .columns { display:grid; grid-template-columns: repeat(4, minmax(0,1fr)); gap:12px; }
  .col { padding:12px; border-radius:16px; background:rgba(255,255,255,.03); border:1px solid rgba(255,255,255,.06); }
  .item { padding:8px 10px; border-radius:12px; background:rgba(255,255,255,.03); border:1px solid rgba(255,255,255,.06); margin-bottom:8px; }
  .muted { opacity:.6; }
  @media (max-width: 1100px) {
    .stats-grid { grid-template-columns: repeat(2, minmax(0,1fr)); }
    .grid { grid-template-columns: 1fr; }
    .columns { grid-template-columns: 1fr; }
  }
</style>
{% endblock %}

