<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>R√©servations</title>
  <style>
    body{margin:0;font-family:system-ui,Segoe UI,Roboto,Arial;background:#0b0f16;color:#e9eef7}
    a{color:inherit}
    .wrap{max-width:1400px;margin:0 auto;padding:18px}
    .top{display:flex;align-items:flex-start;justify-content:space-between;gap:12px;flex-wrap:wrap}
    h2{margin:0 0 12px 0}
    .stats{display:flex;gap:10px;flex-wrap:wrap}
    .stat{border:1px solid rgba(255,255,255,.12);border-radius:14px;padding:10px 12px;min-width:110px;background:rgba(255,255,255,.03)}
    .stat .n{font-size:22px;font-weight:800}
    .stat .l{font-size:12px;opacity:.8}

    .grid2{display:grid;grid-template-columns:1fr 1fr;gap:14px}
    @media(max-width:1100px){.grid2{grid-template-columns:1fr}}
    .card{border:1px solid rgba(255,255,255,.12);border-radius:16px;padding:14px;background:rgba(255,255,255,.02)}
    label{font-size:12px;opacity:.85}
    input,textarea,select{
      padding:10px;border-radius:12px;border:1px solid rgba(255,255,255,.14);
      background:rgba(0,0,0,.18);color:#e9eef7;outline:none
    }
    .form{display:grid;grid-template-columns:1fr 1fr;gap:10px}
    .full{grid-column:1/-1}
    .btn{padding:8px 10px;border-radius:12px;border:1px solid rgba(255,255,255,.14);
      background:rgba(0,0,0,.18);color:#e9eef7;cursor:pointer;text-decoration:none;display:inline-flex;align-items:center;justify-content:center
    }
    .btn:hover{filter:brightness(1.08)}
    .small{padding:6px 9px;border-radius:10px;font-size:12px}
    .primary{background:rgba(0,140,255,.20);border-color:rgba(0,140,255,.30)}
    .warn{background:rgba(255,200,0,.16);border-color:rgba(255,200,0,.28)}
    .danger{background:rgba(255,0,70,.14);border-color:rgba(255,0,70,.26)}
    .success{background:rgba(0,200,120,.16);border-color:rgba(0,200,120,.28)}
    hr{border:none;border-top:1px solid rgba(255,255,255,.10);margin:16px 0}

    .board{display:grid;grid-template-columns:repeat(5,1fr);gap:10px;align-items:start}
    @media(max-width:1400px){.board{grid-template-columns:repeat(2,1fr)}}
    @media(max-width:800px){.board{grid-template-columns:1fr}}
    .col{border:1px solid rgba(255,255,255,.12);border-radius:16px;padding:10px;background:rgba(255,255,255,.02)}
    .colhead{font-weight:800;margin-bottom:8px}
    .ticket{border:1px solid rgba(255,255,255,.12);border-radius:14px;padding:10px;margin-bottom:8px;background:rgba(255,255,255,.03)}
    .title{font-weight:800}
    .sub{display:flex;gap:10px;flex-wrap:wrap;font-size:12px;margin-top:4px;opacity:.9}
    .muted{opacity:.65}
    .actions{display:flex;gap:8px;flex-wrap:wrap;margin-top:10px}
    .flash{padding:10px 12px;border-radius:14px;border:1px solid rgba(255,255,255,.14);margin-bottom:12px;background:rgba(0,0,0,.20)}
  </style>
</head>
<body>
  <div class="wrap">
    <div class="top">
      <div>
        <h2>R√©servations</h2>
      </div>
      <div class="stats">
        <div class="stat"><div class="n">{{ stats.demandes }}</div><div class="l">Demandes</div></div>
        <div class="stat"><div class="n">{{ stats.reserved }}</div><div class="l">R√©serv√©</div></div>
        <div class="stat"><div class="n">{{ stats.ongoing }}</div><div class="l">En location</div></div>
        <div class="stat"><div class="n">{{ stats.done }}</div><div class="l">Termin√©</div></div>
        <div class="stat"><div class="n">{{ stats.canceled }}</div><div class="l">Annul√©</div></div>
      </div>
    </div>

    {% with messages = get_flashed_messages(with_categories=true) %}
      {% if messages %}
        {% for cat, msg in messages %}
          <div class="flash">{{ msg }}</div>
        {% endfor %}
      {% endif %}
    {% endwith %}

    <hr/>

    <div class="grid2">
      <div class="card">
        <h3 style="margin:0 0 10px 0;">Nouvelle r√©servation</h3>
        <form method="post" action="{{ url_for('bookings.create') }}" class="form">
          <div>
            <label>Client</label>
            <input name="client_name" required placeholder="Nom client" />
          </div>
          <div>
            <label>V√©hicule</label>
            <input name="vehicle_name" required placeholder="Nom v√©hicule" />
          </div>

          <div>
            <label>T√©l√©phone</label>
            <input name="client_phone" placeholder="+213..." />
          </div>
          <div>
            <label>Adresse</label>
            <input name="client_address" placeholder="Adresse..." />
          </div>

          <div>
            <label>Document (CNI/Passeport)</label>
            <input name="doc_id" />
          </div>
          <div>
            <label>Permis</label>
            <input name="driver_license" />
          </div>

          <div>
            <label>D√©part</label>
            <input type="datetime-local" name="start_date" required />
          </div>
          <div>
            <label>Retour</label>
            <input type="datetime-local" name="end_date" required />
          </div>

          <div>
            <label>Lieu livraison</label>
            <input name="pickup_location" />
          </div>
          <div>
            <label>Lieu restitution</label>
            <input name="return_location" />
          </div>

          <div>
            <label>Plaque</label>
            <input name="vehicle_plate" />
          </div>
          <div>
            <label>Mod√®le</label>
            <input name="vehicle_model" />
          </div>

          <div class="full">
            <label>Notes</label>
            <textarea name="notes" rows="3"></textarea>
          </div>

          <div class="full" style="display:flex;gap:12px;flex-wrap:wrap;align-items:center">
            <label style="margin-right:8px">Options</label>
            <label class="muted"><input type="checkbox" name="opt_gps" /> GPS</label>
            <label class="muted"><input type="checkbox" name="opt_driver" /> Chauffeur</label>
            <label class="muted"><input type="checkbox" name="opt_baby_seat" /> Si√®ge b√©b√©</label>
          </div>

          <div class="full">
            <button class="btn primary" type="submit">Cr√©er (Demande)</button>
          </div>
        </form>
      </div>

      <div class="card">
        <h3 style="margin:0 0 10px 0;">Aide</h3>
        <div class="muted">Si tu vois encore du code Python sur /bookings/, c‚Äôest que le fichier template n‚Äôest pas bon ou pas au bon endroit.</div>
      </div>
    </div>

    <hr/>

    <div class="board">
      <div class="col">
        <div class="colhead">üì• DEMANDES</div>
        {% for b in demandes %}
          <div class="ticket">
            <div class="title">{{ b.name }}</div>
            <div class="sub">
              {% if b.payload.client_name %}<span>üë§ {{ b.payload.client_name }}</span>{% endif %}
              {% if b.payload.vehicle_name %}<span>üöó {{ b.payload.vehicle_name }}</span>{% endif %}
            </div>
            <div class="sub muted">
              {% if b.payload.start_date %}‚è± {{ b.payload.start_date }}{% endif %}
              {% if b.payload.end_date %} ‚Üí {{ b.payload.end_date }}{% endif %}
            </div>
            <div class="actions">
              <form method="post" action="{{ url_for('bookings.move', card_id=b.id, action='reserved') }}">
                <button class="btn small warn" type="submit">Passer en R√©serv√©</button>
              </form>
              <form method="post" action="{{ url_for('bookings.move', card_id=b.id, action='cancel') }}">
                <button class="btn small danger" type="submit">Annuler</button>
              </form>

              <a class="btn small" href="{{ url_for('contracts.contract_pdf', card_id=b.id) }}?lang=fr" target="_blank">FR</a>
              <a class="btn small" href="{{ url_for('contracts.contract_pdf', card_id=b.id) }}?lang=en" target="_blank">EN</a>
              <a class="btn small" href="{{ url_for('contracts.contract_pdf', card_id=b.id) }}?lang=ar" target="_blank">AR</a>
            </div>
          </div>
        {% else %}
          <div class="muted">Aucune demande.</div>
        {% endfor %}
      </div>

      <div class="col">
        <div class="colhead">üìÖ R√âSERV√â</div>
        {% for b in reserved %}
          <div class="ticket">
            <div class="title">{{ b.name }}</div>
            <div class="actions">
              <form method="post" action="{{ url_for('bookings.contract_and_move', card_id=b.id) }}">
                <select name="lang">
                  <option value="fr">FR</option>
                  <option value="en">EN</option>
                  <option value="ar">AR</option>
                </select>
                <button class="btn small primary" type="submit">G√©n√©rer + En location</button>
              </form>
              <form method="post" action="{{ url_for('bookings.move', card_id=b.id, action='cancel') }}">
                <button class="btn small danger" type="submit">Annuler</button>
              </form>

              <a class="btn small" href="{{ url_for('contracts.contract_pdf', card_id=b.id) }}?lang=fr" target="_blank">FR</a>
              <a class="btn small" href="{{ url_for('contracts.contract_pdf', card_id=b.id) }}?lang=en" target="_blank">EN</a>
              <a class="btn small" href="{{ url_for('contracts.contract_pdf', card_id=b.id) }}?lang=ar" target="_blank">AR</a>
            </div>
          </div>
        {% else %}
          <div class="muted">Aucune r√©servation.</div>
        {% endfor %}
      </div>

      <div class="col">
        <div class="colhead">üîë EN LOCATION</div>
        {% for b in ongoing %}
          <div class="ticket">
            <div class="title">{{ b.name }}</div>
            <div class="actions">
              <form method="post" action="{{ url_for('bookings.move', card_id=b.id, action='done') }}">
                <button class="btn small success" type="submit">Terminer</button>
              </form>
              <a class="btn small" href="{{ url_for('contracts.contract_pdf', card_id=b.id) }}?lang=fr" target="_blank">FR</a>
              <a class="btn small" href="{{ url_for('contracts.contract_pdf', card_id=b.id) }}?lang=en" target="_blank">EN</a>
              <a class="btn small" href="{{ url_for('contracts.contract_pdf', card_id=b.id) }}?lang=ar" target="_blank">AR</a>
            </div>
          </div>
        {% else %}
          <div class="muted">Aucune location en cours.</div>
        {% endfor %}
      </div>

      <div class="col">
        <div class="colhead">‚úÖ TERMIN√â</div>
        {% for b in done %}
          <div class="ticket">
            <div class="title">{{ b.name }}</div>
            <div class="actions">
              <a class="btn small" href="{{ url_for('contracts.contract_pdf', card_id=b.id) }}?lang=fr" target="_blank">FR</a>
              <a class="btn small" href="{{ url_for('contracts.contract_pdf', card_id=b.id) }}?lang=en" target="_blank">EN</a>
              <a class="btn small" href="{{ url_for('contracts.contract_pdf', card_id=b.id) }}?lang=ar" target="_blank">AR</a>
            </div>
          </div>
        {% else %}
          <div class="muted">Aucun termin√©.</div>
        {% endfor %}
      </div>

      <div class="col">
        <div class="colhead">‚ùå ANNUL√â</div>
        {% for b in canceled %}
          <div class="ticket">
            <div class="title">{{ b.name }}</div>
            <div class="actions">
              <a class="btn small" href="{{ url_for('contracts.contract_pdf', card_id=b.id) }}?lang=fr" target="_blank">FR</a>
              <a class="btn small" href="{{ url_for('contracts.contract_pdf', card_id=b.id) }}?lang=en" target="_blank">EN</a>
              <a class="btn small" href="{{ url_for('contracts.contract_pdf', card_id=b.id) }}?lang=ar" target="_blank">AR</a>
            </div>
          </div>
        {% else %}
          <div class="muted">Aucun annul√©.</div>
        {% endfor %}
      </div>
    </div>
  </div>
</body>
</html>

